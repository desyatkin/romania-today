<?php



/*
|-------------------------------------------------------------------------------
| Администрироване сайта
|-------------------------------------------------------------------------------
|
| Все маршруты имеют префикс /admin/
| Закрыто стандартной авторизацией
|
|-------------------------------------------------------------------------------
*/
Route::group(array('before' => 'auth', 'prefix' => 'admin'), function (){

	//------------------------------------------------------------------------------
	// Домашняя страница админки
	//------------------------------------------------------------------------------
	Route::get('/', function() {
		$view = View::make('admin.home');
		return $view;
	});

	//------------------------------------------------------------------------------
	// Категории
	//------------------------------------------------------------------------------
	Route::controller('categories', 'CategoriesController');

	//------------------------------------------------------------------------------
	// Статьи
	//------------------------------------------------------------------------------
	Route::controller('articles', 'ArticlesController');

});


//------------------------------------------------------------------------------
// Форма входа
//------------------------------------------------------------------------------
Route::get('/login', function() {
	return View::make('login');
});

//------------------------------------------------------------------------------
// Авторизация пользователя посредством ajax
//------------------------------------------------------------------------------
Route::post('/login', function () { 
	if (Auth::attempt(array('email' => Input::get('email'), 'password' => Input::get('password')), true)) {
		return Redirect::to('/admin');
	} else {
		return Redirect::to('/login');
	}
});

//------------------------------------------------------------------------------
// Выход пользователя из системы
//------------------------------------------------------------------------------
Route::get('/logout', function () {
	Auth::logout();
	return Redirect::to('/');
});


//------------------------------------------------------------------------------
// Главная страница сайт
//------------------------------------------------------------------------------
Route::get('/', 'SiteController@getShowIndex');


//------------------------------------------------------------------------------
// Категория сайта
//------------------------------------------------------------------------------
Route::get('/{category}', 'SiteController@getShowCategory');


//------------------------------------------------------------------------------
// Подкатегории сайта
//------------------------------------------------------------------------------
Route::get('/{category}/{subcategory}', 'SiteController@getShowSubcategory');


//------------------------------------------------------------------------------
//  Конечная страница со статьей
//------------------------------------------------------------------------------
Route::get('/{category}/{subcategory}/{alias}', 'SiteController@getShowArticle');








